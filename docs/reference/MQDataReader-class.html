<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>S5-RefClass to read MaxQuant .txt files — MQDataReader-class • PTXQC</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="S5-RefClass to read MaxQuant .txt files — MQDataReader-class"><meta property="og:description" content="This class is used to read MQ data tables using MQDataReader::readMQ() while holding
the internal raw file –&amp;gt; short raw file name mapping (stored in a member called
'fn_map') and updating/using it every time MQDataReader::readMQ() is called."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PTXQC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/PTXQC-Basic_Guide_for_R_users.html">Basic R-Usage Guide for PTXQC</a>
    </li>
    <li>
      <a href="../articles/PTXQC-CustomizeReport.html">Customizing PTXQC reports</a>
    </li>
    <li>
      <a href="../articles/PTXQC-DragNDrop.html">Drag'n'drop Usage Guide for PTXQC</a>
    </li>
    <li>
      <a href="../articles/PTXQC-FAQ.html">Frequently asked questions for PTXQC</a>
    </li>
    <li>
      <a href="../articles/PTXQC-Input_And_Output_Data.html">Input/Output data for PTXQC</a>
    </li>
    <li>
      <a href="../articles/PTXQC-ListOfMetrics.html">List of Metrics</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/cbielow/PTXQC/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>S5-RefClass to read MaxQuant .txt files</h1>
    <small class="dont-index">Source: <a href="https://github.com/cbielow/PTXQC/blob/HEAD/R/MQDataReader.R" class="external-link"><code>R/MQDataReader.R</code></a></small>
    <div class="hidden name"><code>MQDataReader-class.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This class is used to read MQ data tables using <code>MQDataReader::readMQ()</code> while holding
the internal raw file –&gt; short raw file name mapping (stored in a member called
'fn_map') and updating/using it every time <code>MQDataReader::readMQ()</code> is called.</p>
    </div>


    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>(Relative) path to a MQ txt file.</p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>Searched for "C" and "R". If present, [c]ontaminants and [r]everse hits are removed if the respective columns are present.
E.g. to filter both, <code>filter = "C+R"</code></p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Allowed values are:
"pg" (proteinGroups) [default], adds abundance index columns (*AbInd*, replacing 'intensity')
"sm" (summary), splits into three row subsets (raw.file, condition, total)
"ev" (evidence), will fix empty modified.sequence cells for older MQ versions (when MBR is active)
"msms_scans", will fix invalid (negative) scan event numbers
Any other value will not add/modify any columns</p></dd>


<dt id="arg-col-subset">col_subset<a class="anchor" aria-label="anchor" href="#arg-col-subset"></a></dt>
<dd><p>A vector of column names as read by read.delim(), e.g., spaces are replaced by dot already.
If given, only columns with these names (ignoring lower/uppercase) will be returned (regex allowed)
E.g. col_subset=c("^lfq.intensity.", "protein.name")</p></dd>


<dt id="arg-add-fs-col">add_fs_col<a class="anchor" aria-label="anchor" href="#arg-add-fs-col"></a></dt>
<dd><p>If TRUE and a column 'raw.file' is present, an additional column 'fc.raw.file' will be added with
common prefix AND common substrings removed (<code><a href="simplifyNames.html">simplifyNames</a></code>)
        E.g. two rawfiles named 'OrbiXL_2014_Hek293_Control', 'OrbiXL_2014_Hek293_Treated' will give
                                'Control', 'Treated'
If <code>add_fs_col</code> is a number AND the longest short-name is still longer, the names are discarded and replaced by
a running ID of the form 'file &lt;x&gt;', where &lt;x&gt; is a number from 1 to N.
If the function is called again and a mapping already exists, this mapping is used.
Should some raw.files be unknown (ie the mapping from the previous file is incomplete), they will be augmented</p></dd>


<dt id="arg-check-invalid-lines">check_invalid_lines<a class="anchor" aria-label="anchor" href="#arg-check-invalid-lines"></a></dt>
<dd><p>After reading the data, check for unusual number of NA's to detect if file was corrupted by Excel or alike</p></dd>


<dt id="arg-lfq-action">LFQ_action<a class="anchor" aria-label="anchor" href="#arg-lfq-action"></a></dt>
<dd><p>[For type=='pg' only] An additional custom LFQ column ('cLFQ...') is created where
zero values in LFQ columns are replaced by the following method IFF(!) the corresponding raw intensity is &gt;0 (indicating that LFQ is erroneusly 0)
"toNA": replace by NA
"impute": replace by lowest LFQ value &gt;0 (simulating 'noise')</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional parameters passed on to read.delim()</p></dd>


<dt id="arg-colname">colname<a class="anchor" aria-label="anchor" href="#arg-colname"></a></dt>
<dd><p>Name of the column (e.g. 'contaminants') in the mq.data table</p></dd>


<dt id="arg-valid-entries">valid_entries<a class="anchor" aria-label="anchor" href="#arg-valid-entries"></a></dt>
<dd><p>Vector of values to be replaced (must contain all values expected in the column – fails otherwise)</p></dd>


<dt id="arg-replacements">replacements<a class="anchor" aria-label="anchor" href="#arg-replacements"></a></dt>
<dd><p>Vector of values inserted with the same length as <code>valid_entries</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data.frame of the respective file</p>

<p>Replaces values in the mq.data member with (binary) values.
Most MQ tables contain columns like 'contaminants' or 'reverse', whose values are either empty strings
or "+", which is inconvenient and can be much better represented as TRUE/FALSE.
The params <code>valid_entries</code> and <code>replacements</code> contain the matched pairs, which determine what is replaced with what.</p>
<p>Returns <code>TRUE</code> if successful.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Since MaxQuant changes capitalization and sometimes even column names, it seemed convenient
to have a function which just reads a txt file and returns unified column names, irrespective of the MQ version.
So, it unifies access to columns (e.g. by using lower case for ALL columns) and ensures columns are
identically named across MQ versions:</p><div class="sourceCode"><pre><code>
 alternative term          new term
 -----------------------------------------
 protease                  enzyme
 protein.descriptions      fasta.headers
 potential.contaminant     contaminant
 mass.deviations           mass.deviations..da.
 basepeak.intensity        base.peak.intensity
</code></pre></div>

<p>We also correct 'reporter.intensity.*' naming issues to MQ 1.6 convention, when 'reporter.intensity.not.corrected' is present.
MQ 1.5 uses: reporter.intensity.X and reporter.intensity.not.corrected.X
MQ 1.6 uses: reporter.intensity.X and reporter.intensity.corrected.X</p>
<p>Note: you must find a regex which matches both versions, or explicitly add both terms if you are requesting only a subset
      of columns!</p>
<p>Fixes for msmsScans.txt:
 negative Scan Event Numbers in msmsScans.txt are reconstructed by using other columns</p>
<p>Automatically detects UTF8-BOM encoding and deals with it (since MQ2.4).</p>
<p>Example of usage:</p><div class="sourceCode"><pre><code><span></span>
<span>  <span class="va">mq</span> <span class="op">=</span> <span class="va"><a href="../reference/MQDataReader-class.html">MQDataReader</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">d_evd</span> <span class="op">=</span> <span class="va">mq</span><span class="op">$</span><span class="fu">readMQ</span><span class="op">(</span><span class="st">"evidence.txt"</span>, type<span class="op">=</span><span class="st">"ev"</span>, filter<span class="op">=</span><span class="st">"R"</span>, col_subset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proteins"</span>, <span class="st">"Retention.Length"</span>, <span class="st">"retention.time.calibration"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>If the file is empty, this function shows a warning and returns NULL.
If the file is present but cannot be read, the program will stop.</p>

<p>Wrapper to read a MQ txt file (e.g. proteinGroups.txt).</p>
    </div>
    <div id="methods">
    <h2>Methods</h2>


<dl><dt><code>getInvalidLines()</code></dt>
<dd><p>Detect broken lines (e.g. due to Excel import+export)</p>
<p>When editing a MQ txt file in Microsoft Excel, saving the file can cause it to be corrupted,
   since Excel has a single cell content limit of 32k characters
   (see http://office.microsoft.com/en-001/excel-help/excel-specifications-and-limits-HP010342495.aspx)
   while MQ can easily reach 60k (e.g. in oxidation sites column).
   Thus, affected cells will trigger a line break, effectively splitting one line into two (or more).</p>
<p>If the table has an 'id' column, we can simply check the numbers are consecutive. If no 'id' column is available,
   we detect line-breaks by counting the number of NA's per row and finding outliers.
   The line break then must be in this line (plus the preceeding or following one). Depending on where
   the break happened we can also detect both lines right away (if both have more NA's than expected).</p>
<p>Currently, we have no good strategy to fix the problem since columns are not aligned any longer, which
   leads to columns not having the class (e.g. numeric) they should have.
   (thus one would need to un-do the linebreak and read the whole file again)</p>
<p>[Solution to the problem: try LibreOffice 4.0.x or above – seems not to have this limitation]</p>
<p>@return Returns a vector of indices of broken (i.e. invalid) lines</p></dd>


</dl></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Chris Bielow.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer></div>






  </body></html>

